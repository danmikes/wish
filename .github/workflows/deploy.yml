name: Deploy to PythonAnywhere

on:
  # push:
  #   branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Deploy via SSH
      uses: appleboy/ssh-action@v0.1.10
      with:
        host: ${{ secrets.PYTHONANYWHERE_HOST }}
        username: ${{ secrets.PYTHONANYWHERE_USERNAME }}
        key: ${{ secrets.PYTHONANYWHERE_SSH_KEY }}
        script: |
          set -e  # Exit on error
          cd /home/${{ secrets.PYTHONANYWHERE_USERNAME }}/wish/

          echo "üîÑ Pulling latest code ..."
          git fetch origin
          git reset --hard origin/main

          echo "üêç Activating virtual environment..."
          source /home/${{ secrets.PYTHONANYWHERE_USERNAME }}/.virtualenvs/wish-venv/bin/activate

          echo "üì¶ Installing dependencies ..."
          pip install --user -r requirements.txt  #

          echo "üöÄ Reloading web application ..."
          touch /var/www/${{ secrets.PYTHONANYWHERE_USERNAME }}_eu_pythonanywhere_com_wsgi.py

          echo "‚úÖ Deployment completed!"
